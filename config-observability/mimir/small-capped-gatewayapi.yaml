mimir-distributed:
  # Enabled mimir ingress for center of the architecture
  ingress:
    enabled: false

  # enable minio for object storage
  minio:
    enabled: true
    
  # Global Config: Reduce replication to save 33% of resources
  mimir:
    structuredConfig:
      limits:
        # Limit queries to 500 days. You can override this on a per-tenant basis.
        max_total_query_length: 12000h
        # Adjust max query parallelism to 16x sharding, without sharding we can run 15d queries fully in parallel.
        # With sharding we can further shard each day another 16 times. 15 days * 16 shards = 240 subqueries.
        max_query_parallelism: 240
        # Avoid caching results newer than 10m because some samples can be delayed
        # This presents caching incomplete results
        max_cache_freshness: 10m
        # Maximum number of rules per rule group per-tenant. 0 to disable.
        ruler_max_rules_per_rule_group: 0
        # Maximum number of rule groups per-tenant. 0 to disable.
        ruler_max_rule_groups_per_tenant: 0  

  kafka:
    enabled: true
    resources:
      requests:
        cpu: 1
        memory: 1Gi
      limits: 
        memory: 1Gi 

  alertmanager:
    replicas: 1  # Minimalist (Single pod is enough for basic alerting)
    resources:
      requests:
        cpu: 100m
        memory: 256Mi

  compactor:
    persistentVolume:
      size: 30Gi # Reduced from 50Gi
    resources:
      requests:
        cpu: 500m
        memory: 1Gi # Essential for 1-year retention processing

  distributor:
    replicas: 2
    resources:
      requests:
        cpu: 200m
        memory: 512Mi # Distributors are stateless and light

  ingester:
    replicas: 2  # Reduced from 3 (Matches RF=2)
    persistentVolume:
      size: 20Gi # Reduced (We flush to S3 every 2h anyway)
    resources:
      requests:
        cpu: 500m
        memory: 2Gi # Minimum safe RAM for 1M active series
    zoneAwareReplication:
      enabled: false  # Disable for small setups to save resources

  store_gateway:
    replicas: 2  # Matches RF=2
    persistentVolume:
      size: 10Gi
    resources:
      requests:
        cpu: 200m
        memory: 1Gi # Low RAM thanks to lazy loading
    zoneAwareReplication:
      enabled: false  # Disable for small setups to save resources

  querier:
    replicas: 2 # 2 for basic HA on queries
    resources:
      requests:
        cpu: 100m
        memory: 128Mi

  query_frontend:
    replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 256Mi

  # Disable all extra caches to save cost/complexity unless query speed is slow
  chunks-cache: { enabled: false }
  index-cache: { enabled: false }
  metadata-cache: { enabled: false }
  results-cache: { enabled: false }

  gateway:
    replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 128Mi